window.addEventListener("load",function()
{
    //console.log("function begin here");
    function a(a)
    {

        a.querySelectorAll(".remove").forEach(a=>
        {a.addEventListener("click",()=>
            {a.parentNode.remove()})})}
        function b(b){
            const d=b.querySelector(".array-item"),e=d.cloneNode(!0),f=d.parentElement;d.getAttribute("data-isNone")&&(d.remove(),e.removeAttribute("data-isNone"),e.removeAttribute("style")),a(b);
            let c =1;
            let g = f.querySelectorAll("input");
            let last_save_element_id ;
            for (const x of g){
                last_save_element_id=x.id;
            }
            let last_save_element_index;
            
            try{  
                last_save_element_index=last_save_element_id.split("_").at(-1); 
                c =parseInt(last_save_element_index)+1;
                if( c===1 && !document.getElementById(last_save_element_id).value ){
                    RouteToFunction(last_save_element_id);
                    console.log("inside try");
                }
            }
            catch(error){
                last_save_element_index=0; 
                c=1;
                last_save_element_id =e.childNodes[0].id;
            }
            b.querySelector(".add-array-item").addEventListener("click",()=>{
            // console.log("inside add-arrayitem");
            let dict =last_save_element_id.split("_");
            dict[2]=c.toString();
            c++;
            input_id =dict.join("_");

            const b=e.cloneNode(!0),d=b.querySelector("input").getAttribute("id").split("_"),g=d.slice(0,-1).join("_")+"_"+(c-1+"");

            b.querySelector("input").setAttribute("id",g),b.querySelector("input").value="",a(b),f.appendChild(b)
            RouteToFunction(input_id);
        }
            )
        }

        django.jQuery(".dynamic-array-widget").not(".empty-form .dynamic-array-widget").each((a,c)=>b(c)),django.jQuery(document).on("formset:added",function(a,c)
        {
            c[0].querySelectorAll(".dynamic-array-widget").forEach(a=>b(a))})});
